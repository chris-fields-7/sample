---
title: 'Google Case Study #1'
author: "Chris Fields"
date: "`r Sys.Date()`"
output: html_document
---
```{r}
library(tidyverse)
library(lubridate)
```

# Cyclistic Bike Share Analysis


#### Question to be answered:

* What are the differences in Cyclistic bike usage between annual members and
casual riders?

  + How could stakeholders use this information to convert casual riders into
annual members?

The data used for this case study was generated by Divvy, a bicycle sharing
service owned by the City of Chicago and operated by Lyft Bikes & Scooters, LLC.

This data has been made available for use by Motivate International Inc.

* [License for Use](https://ride.divvybikes.com/data-license-agreement)
* [Data Source](https://divvy-tripdata.s3.amazonaws.com/index.html)

#### Cleaning and Preparation of Data:

The most current data available is provided on a monthly basis, stored as comma-
separated values.

**Step #1:** Import the data for analysis.

```{r}
cyclistic_oct_21 <- read.csv("csv_data/202110-divvy-tripdata.csv")
cyclistic_nov_21 <- read.csv("csv_data/202111-divvy-tripdata.csv")
cyclistic_dec_21 <- read.csv("csv_data/202112-divvy-tripdata.csv")
cyclistic_jan_22 <- read.csv("csv_data/202201-divvy-tripdata.csv")
cyclistic_feb_22 <- read.csv("csv_data/202202-divvy-tripdata.csv")
cyclistic_mar_22 <- read.csv("csv_data/202203-divvy-tripdata.csv")
cyclistic_apr_22 <- read.csv("csv_data/202204-divvy-tripdata.csv")
cyclistic_may_22 <- read.csv("csv_data/202205-divvy-tripdata.csv")
cyclistic_jun_22 <- read.csv("csv_data/202206-divvy-tripdata.csv")
cyclistic_jul_22 <- read.csv("csv_data/202207-divvy-tripdata.csv")
cyclistic_aug_22 <- read.csv("csv_data/202208-divvy-tripdata.csv")
cyclistic_sep_22 <- read.csv("csv_data/202209-divvy-publictripdata.csv")
```

**Step #2:** Compare the structure of the first two data sets to identify
any differences between column names or data types.

```{r}
str(cyclistic_oct_21)
```

```{r}
str(cyclistic_nov_21)
```

**Step #3:** Merge the twelve months of data in to a single data set.

```{r}
cyclistic_complete <- bind_rows(cyclistic_oct_21, cyclistic_nov_21, 
                                cyclistic_dec_21, cyclistic_jan_22, 
                                cyclistic_feb_22, cyclistic_mar_22,
                                cyclistic_apr_22, cyclistic_may_22, 
                                cyclistic_jun_22, cyclistic_jul_22, 
                                cyclistic_aug_22, cyclistic_sep_22)
head(cyclistic_complete)
```

**Step #4:** Add a variable to calculate the length of time for each ride 
(in seconds) and then convert ride time to minutes.

```{r}
cyclistic_complete$ride_time <- (ymd_hms(cyclistic_complete$ended_at)) -
                                (ymd_hms(cyclistic_complete$started_at))

cyclistic_complete$ride_time <- cyclistic_complete$ride_time / dminutes()

summary(cyclistic_complete$ride_time)
```

**Step #5:** Create separate variables to capture the month, day, year, and 
day of the week each ride occurred.

```{r}
cyclistic_complete$month <- format(as.Date(cyclistic_complete$started_at), "%m")
cyclistic_complete$day <- format(as.Date(cyclistic_complete$started_at), "%d")
cyclistic_complete$year <- format(as.Date(cyclistic_complete$started_at), "%Y")
cyclistic_complete$day_of_week <- format(as.Date(cyclistic_complete$started_at), "%A")
head(cyclistic_complete)
```
**Step #6:** Remove bad data; rides with a negative duration and any rides where
Divvy HQ-QR had taken the bikes out for inspection.

* The remaining data will be placed in a new data frame, as rows of data will be
removed by this process.

```{r}
cyclistic_v2 <- cyclistic_complete[!(cyclistic_complete$start_station_name == "HQ QR" |                                               cyclistic_complete$ride_time < 0),]
cat("The number of rows removed = ", (nrow(cyclistic_complete) - nrow(cyclistic_v2)))
```

#### Descriptive Analysis of Data:

**Step #1:** Obtain a summary analysis of the 'ride_time' variable.

```{r}
summary(cyclistic_v2$ride_time)
```

**Step #2:** Obtain the summary statistics for the ride time for each category 
of customer, members and casual riders.
 
* *Insight:* On average, casual riders ride the bikes for 29.36 min. while members
ride the bikes for 12.77 min..  These averages skew slightly higher due to high
maximum values; the longest time a casual rider had a bike was 28 days, and the 
longest for a member was 1 day.

```{r}
aggregate(cyclistic_v2$ride_time ~ cyclistic_v2$member_casual, FUN = mean)
aggregate(cyclistic_v2$ride_time ~ cyclistic_v2$member_casual, FUN = median)
aggregate(cyclistic_v2$ride_time ~ cyclistic_v2$member_casual, FUN = max)
aggregate(cyclistic_v2$ride_time ~ cyclistic_v2$member_casual, FUN = min)
```

**Step #3:** Put the days of the week into the proper order and then find the 
average ride time for each category of customer.

```{r}
cyclistic_v2$day_of_week <- ordered(cyclistic_v2$day_of_week, levels = c("Sunday",
                                    "Monday", "Tuesday", "Wednesday", "Thursday",
                                    "Friday", "Saturday"))

aggregate(cyclistic_v2$ride_time ~ cyclistic_v2$member_casual +
           cyclistic_v2$day_of_week, FUN = mean)
```
**Step #4:** Create a visualization which shows the average daily ride time for 
each category of users.

* *Insight:* While each group of riders spends more time on the bikes from
 Thursday to Monday, the increase in minutes used is much greater for casual 
 riders.

```{r}
cyclistic_v2 %>%
  mutate(weekday = wday(started_at, label = TRUE)) %>%
  group_by(member_casual, weekday) %>%
  summarize(number_of_rides = n(), average_duration = mean(ride_time)) %>%
  arrange(member_casual, weekday) %>%
  ggplot(aes(x = weekday, y = average_duration, fill = member_casual)) +
  geom_col(position = "dodge") + 
  ggtitle("Average Duration of Rides (Weekly): Casual Riders vs. Members") +
  xlab("") +
  ylab("Average Ride Time")
```

**Step #5** Create a visualization for the total number of rides per weekday.

* *Insight:* Members complete a greater number of rides from Monday through 
Friday.

  + Casual riders who are consistent users during the workweek may be open to 
  considering membership, as the members are much higher users during the 
  workweek.

```{r}
cyclistic_v2 %>%
  mutate(weekday = wday(started_at, label = TRUE)) %>%
  group_by(member_casual, weekday) %>%
  summarize(number_of_rides = n(), average_duration = mean(ride_time)) %>%
  arrange(member_casual, weekday) %>%
  ggplot(aes(x = weekday, y = number_of_rides, fill = member_casual)) +
  geom_col(position = "dodge") + 
  ggtitle("Total Number of Rides (Weekly): Casual Riders vs. Members") +
  xlab("") +
  ylab("Number of Rides")
```

**Step #6:** Find the total number of times the 'classic' style of bikes are
used throughout the week.

* *Insight:* Members are greater users of 'classic' bikes throughout the work 
week.  Whereas, casual riders have higher 'classic' usage on the weekends.

```{r}
cyclistic_v2 %>%
  filter(rideable_type == "classic_bike") %>%
  group_by(member_casual, day_of_week) %>%
  summarise(number_of_rides = n(), average_duration = mean(ride_time)) %>%
  arrange(member_casual, day_of_week) %>%
  ggplot(aes(x = day_of_week, y = number_of_rides  , fill = member_casual)) +
  geom_col(position = "dodge") +
  ggtitle("Total Number of Classic Bike Rides (Weekly): Casual Riders vs. Members") +
  xlab("") +
  ylab("Number of Rides")
```

**Step #7:** Find the total number of times the 'electric' style of bikes are
used throughout the week.

* *Insight:* While the data for the 'electric' style of bikes is consistent with
what was seen with 'classic' bikes, the gap between customer groups is more 
narrow with the 'electric' bikes.

```{r}
cyclistic_v2 %>%
  filter(rideable_type == "electric_bike") %>%
  group_by(member_casual, day_of_week) %>%
  summarise(number_of_rides = n(), average_duration = mean(ride_time)) %>%
  arrange(member_casual, day_of_week) %>%
  ggplot(aes(x = day_of_week, y = number_of_rides  , fill = member_casual)) +
  geom_col(position = "dodge") +
  ggtitle("Total Number of E-Bike Rides (Weekly): Casual Riders vs. Members") +
  xlab("") +
  ylab("Number of Rides")
```

**Step #8:** Create a visualization for the average duration of rides by month.

* Note: This data set is the trailing twelve months, beginning in October, 2021, 
and ending in September, 2022.  Therefore, the months have been re-ordered to 
match the time frame.

* *Insight:* Casual riders consistently take longer rides throughout the year, 
with peaks in October, January, March, and June.
 
```{r}
cyclistic_v2$month <- ordered(cyclistic_v2$month, levels = c("10", "11", "12",
                              "01", "02", "03", "04", "05", "06", "07", "08",
                              "09"))
cyclistic_v2$month <- recode(cyclistic_v2$month, "10" = "Oct. '21", "11" = 
                           "Nov. '21", "12" = "Dec. '21", "01" = "Jan. '22",
                            "02" = "Feb. '22", "03" = "Mar. '22", "04" = 
                              "Apr. '22", "05" = "May '22", "06" = "Jun. '22",
                            "07" = "Jul. '22", "08" = "Aug. '22", "09" = 
                              "Sep. '22")

cyclistic_v2 %>%
  group_by(member_casual, month) %>%
  summarise(number_of_rides = n(), average_duration = mean(ride_time)) %>%
  arrange(member_casual, month) %>%
  ggplot(aes(x = month, y = average_duration, fill = member_casual)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 45)) +
  ggtitle("Average Duration of Rides (Monthly): Casual Riders vs. Members") +
  xlab("") +
  ylab("Average Ride Time")
```

**Step #9:** Create a visualization for the total number of rides per month.

* *Insight:* While overall ridership begins to rise in Spring, the ridership 
data for both categories of users is similar at the peak in July.

  + This would be an ideal time for a digital media campaign while ridership
  is at its highest level and visibility of bikes throughout the city is 
  maximized.

```{r}
cyclistic_v2 %>%
  group_by(member_casual, month) %>%
  summarise(number_of_rides = n(), average_duration = mean(ride_time)) %>%
  arrange(member_casual, month) %>%
  ggplot(aes(x = month, y = number_of_rides, fill = member_casual)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 45)) +
  ggtitle("Total Number of Rides (Monthly): Casual Riders vs. Members") +
  xlab("") +
  ylab("Number of Rides")
```


**Step #10:** Create a visualization for the average duration of rides per month.

* *Insight:* It makes sense that the duration of 'classic' rides is longer than 
the duration of 'electric' rides, as E-Bikes are probably quicker.

```{r}
cyclistic_v2 %>%
  filter(rideable_type != "docked_bike") %>%
  group_by(rideable_type, month) %>%
  summarise(number_of_rides = n(), average_duration = mean(ride_time)) %>%
  arrange(rideable_type, month) %>%
  ggplot(aes(x = month, y = average_duration, fill = rideable_type)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 45)) +
  ggtitle("Average Duration of Rides (Monthly): Classic Bike vs. E-Bike") +
  xlab("") +
  ylab("Average Ride Time")
```

**Step #11:**Create a visualization for the total number of rides per month;
classic bikes vs. electric bikes.

* *Insight:* While classic bikes are more popular in late Spring, the popularity 
of 'electric' bikes is highest in late Summer and early Fall.

```{r}
cyclistic_v2 %>%
  filter(rideable_type != "docked_bike") %>%
  group_by(rideable_type, month) %>%
  summarise(number_of_rides = n(), average_duration = mean(ride_time)) %>%
  arrange(rideable_type, month) %>%
  ggplot(aes(x = month, y = number_of_rides  , fill = rideable_type)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 45)) +
  ggtitle("Total Number of Rides (Monthly): Casual Riders vs. Members") +
  xlab("") +
  ylab("Number of Rides")
```


**Step #12:** Create a visualization for the total number rides for the 'classic'
 style of bike, per month.
 
* *Insight:* Members exhibit a significant preference for 'classic' bikes over 
'electric' bikes.

  + Casual riders who prefer 'classic' bikes over 'electric' may be more 
  amenable to membership promotions due to similar preferences.

```{r}
cyclistic_v2 %>%
  filter(rideable_type == "classic_bike") %>%
  group_by(member_casual, month) %>%
  summarise(number_of_rides = n(), average_duration = mean(ride_time)) %>%
  arrange(member_casual, month) %>%
  ggplot(aes(x = month, y = number_of_rides  , fill = member_casual)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 45)) +
  ggtitle("Total Number of 'Classic' Rides (Monthly): Casual Riders vs. Members") +
  xlab("") +
  ylab("Number of Rides")
```

**Step #13:** Create a visualization for the total number rides for the 'electric'
 style of bike, per month.
 
* *Insight:* Although there are casual users and members have a similar usage 
pattern for 'electric' bikes throughout the year, members have a strong preference 
for 'electric' bikes in the Winter months.

```{r}
cyclistic_v2 %>%
  filter(rideable_type == "electric_bike") %>%
  group_by(member_casual, month) %>%
  summarise(number_of_rides = n(), average_duration = mean(ride_time)) %>%
  arrange(member_casual, month) %>%
  ggplot(aes(x = month, y = number_of_rides  , fill = member_casual)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 45)) +
  ggtitle("Total Number of 'E-Bike' Rides (Monthly): Casual Riders vs. Members") +
  xlab("") +
  ylab("Number of Rides")
```

**Step #14** Isolate data for export to Tableau.

* Weekly ride data.

```{r}
weekly_ride_data <- cyclistic_v2 %>%
  mutate(weekday = wday(started_at, label = TRUE)) %>%
  group_by(member_casual, weekday) %>%
  summarize(number_of_rides = n(), average_duration = mean(ride_time)) %>%
  arrange(member_casual, weekday)
write.csv(weekly_ride_data, file = "csv_data/weekly_ride_data.csv")
```

* Monthly ride data.

```{r}
monthly_ride_data <- cyclistic_v2 %>%
  group_by(member_casual, month) %>%
  summarise(number_of_rides = n(), average_duration = mean(ride_time)) %>%
  arrange(member_casual, month)
write.csv(monthly_ride_data, file = "csv_data/monthly_ride_data.csv")
```

* Geo-location data.

```{r}
casual_geo_data <- cyclistic_v2 %>%
  filter(member_casual == "casual") %>%
  filter(month == "Jun. '22")
casual_geo_data <- casual_geo_data %>%
  select(c(start_lat, start_lng))
str(casual_geo_data)

member_geo_data <- cyclistic_v2 %>%
  filter(member_casual == "member") %>%
  filter(month == "Jun. '22")
member_geo_data <- member_geo_data %>%
  select(c(start_lat, start_lng))
str(member_geo_data)

# Export both sets of data for use in Tableau
write.csv(casual_geo_data, file = "csv_data/casual_start_loc.csv")
write.csv(member_geo_data, file = "csv_data/member_start_loc.csv")
```


